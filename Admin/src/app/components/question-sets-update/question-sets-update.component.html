<div class="row">
    <div class="col-12">
        <div class=" mb-3">
            <h3  class="text-uppercase ">{{title}}</h3>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-xl-6">
        <div class="card mb-4">
            <h5 class="card-header">Thông tin chung</h5>
            <div class="card-body">

              <div class="mb-3 row">
                <label for="name" class="col-md-2 col-form-label">Tên</label>
                <div class="col-md-10">
                  <input class="form-control" type="text" id="name" [(ngModel)]="questionSet.name">
                </div>
              </div>

              <div class="mb-3 row">
                <label for="desc" class="form-label col-md-2">Mô tả</label>
                <div class="col-md-10">
                    <textarea class="form-control" id="desc" rows="3" [(ngModel)]="questionSet.description"></textarea>
                </div>
              </div>

              <div class="mb-3 row">
                <label for="formFile" class="form-label col-md-2">Ảnh</label>
                <div class="col-md-10">

                    <div class="d-flex align-items-start align-items-sm-center gap-4">

                        <img [src]="questionSet.imageUrl" alt="set-image" 
                        class="d-block rounded" style="object-fit: cover;" height="100" width="100" id="uploadedAvatar">
                        
                        <div class="button-wrapper">
                          <label for="upload" class="btn btn-primary me-2 mb-4" tabindex="0">
                            <span class="d-none d-sm-block">Tải ảnh mới</span>
                            <i class="bx bx-upload d-block d-sm-none"></i>
                            <input type="file" id="upload" class="account-file-input" (change)="onFileSelected($event)" hidden="" accept="image/png, image/jpeg">
                          </label>
                          <button type="button"  class="btn btn-outline-secondary account-image-reset mb-4">
                            <i class="bx bx-reset d-block d-sm-none"></i>
                            <span class="d-none d-sm-block">Reset</span>
                          </button>

                          <p class="text-muted mb-0">Allowed JPG, GIF or PNG. Max size of 800K</p>
                        </div>
                    </div>

                </div>
              </div>

              <div class="mb-3 row">
                <label for="min" class="col-2 col-form-label">Phút</label>
                <div class="col-4">
                  <input class="form-control" id="min" type="number" placeholder="Số phút" [(ngModel)]="questionSet.testTime.minutes">
                </div>
                <label for="sec" class="col-2 col-form-label">Giây</label>
                <div class="col-4">
                  <input class="form-control" id="sec" type="number" placeholder="Số giây" [(ngModel)]="questionSet.testTime.seconds">
                </div>
              </div>

              <div class="d-flex justify-content-center mt-5 ">
                <button (click)="checkValidAndConfirm()" type="button" class="btn btn-dark ms-1 " data-bs-toggle="modal" data-bs-target="#modalToggle">
                    Cập nhật
                </button>
              </div>
            </div>
        </div>
    </div>
    <div class="col-xl-6">
        <div class="card mb-4 h-100">
            <div class="card-header d-flex justify-content-between">
                <h5 class="my-auto ">Danh sách câu hỏi</h5>
                
                <div class="d-flex">

                  <div *ngIf="selectedCount" class="d-flex shadow text-center my-auto text align-items-center me-3" style="border-radius: 50rem;">
                    <h6 class="my-auto ps-3" style="font-size: smaller;">Đã chọn {{selectedCount}} câu</h6>
                    <a (click)="cancelSelectAll()" type="button" class="btn rounded-pill float-end p-0 m-1 ">
                      <i class='bx bx-x-circle text-danger'></i>
                    </a>
                  </div>

                  <a type="button" class="btn rounded-pill btn-icon btn-outline-secondary">
                      <i class='bx bx-search'></i>
                  </a>

                  <a (click)="removeSelected()" *ngIf="selectedCount" type="button" class="btn ms-1 rounded-pill btn-icon btn-outline-secondary">
                      <i class='bx bx-trash'></i>
                  </a>

                  <a *ngIf="selectedCount==1" (click)="getEditQuestion()" type="button" 
                  class="btn ms-1 rounded-pill btn-icon btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#editModal">
                    <i class='bx bx-edit-alt' ></i>
                  </a>

                  <a type="button" (click)="openAddModal()" class="btn ms-1 rounded-pill btn-icon btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#addModal">
                    <i class='bx bx-plus-medical'></i>
                  </a>

                </div>
            </div>

            <div class="card-body overflow-auto vh-100" >
                <div class="list-group">
                    <div *ngFor="let item of questions" [ngClass]="{'border-4':item.selected, 'border-info':item.selected}" class="list-group-item mb-2 border-2 rounded-1 text-wrap">
                        <div class="row">
                            <div class="col-1">
                                <input 
                                  class="form-check-input me-1" 
                                  type="checkbox" 
                                  [(ngModel)]="item.selected"
                                  (ngModelChange)="onSelectedChange()">
                            </div>
                            <label class="col-11">
                                {{ item.content }}
                                <ul class="list-group rounded-0 my-3">

                                    <li 
                                    class="list-group-item list-group-item-action" 
                                    [class.active]="item.correctAnswer == 1" 
                                    (click)="item.changeCorrectAnswer(1)">
                                        {{ item.answerA }}
                                    </li>

                                    <li 
                                    class="list-group-item list-group-item-action" 
                                    [class.active]="item.correctAnswer == 2" 
                                    (click)="item.changeCorrectAnswer(2)">
                                        {{ item.answerB }}
                                    </li>

                                    <li 
                                    class="list-group-item list-group-item-action" 
                                    [class.active]="item.correctAnswer == 3" 
                                    (click)="item.changeCorrectAnswer(3)">
                                        {{ item.answerC }}
                                    </li>

                                    <li 
                                    class="list-group-item list-group-item-action" 
                                    [class.active]="item.correctAnswer == 4" 
                                    (click)="item.changeCorrectAnswer(4)">
                                        {{ item.answerD }}
                                    </li>
                                    
                                </ul>
                            </label>
                        </div>
                    </div>

                </div>
            </div>

            <nav class="mt-3" aria-label="Page navigation">
                <ul class="pagination justify-content-center ">
                  <li class="page-item first">
                    <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevrons-left"></i></a>
                  </li>
                  <li class="page-item prev">
                    <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-left"></i></a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="javascript:void(0);">1</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="javascript:void(0);">2</a>
                  </li>
                  <li class="page-item active">
                    <a class="page-link" href="javascript:void(0);">3</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="javascript:void(0);">4</a>
                  </li>
                  <li class="page-item">
                    <a class="page-link" href="javascript:void(0);">5</a>
                  </li>
                  <li class="page-item next">
                    <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevron-right"></i></a>
                  </li>
                  <li class="page-item last">
                    <a class="page-link" href="javascript:void(0);"><i class="tf-icon bx bx-chevrons-right"></i></a>
                  </li>
                </ul>
            </nav>
        </div>

        
    </div>
</div>

<!-- Confirm Modal -->
<div class="modal fade" id="modalToggle" aria-labelledby="modalToggleLabel" tabindex="-1" style="display: none;" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalToggleLabel">{{modalTitle}}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex flex-column">
        <div>{{modelMessage}}</div>
      </div>
      <div class="modal-footer">
        <button (click)="saveQuestionSets()" class="btn btn-primary" data-bs-toggle="modal" data-bs-dismiss="modal">
          OK
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit question modal -->
<div class="modal fade" id="editModal" tabindex="-1" style="display: none;" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Chỉnh sửa câu hỏi (Ctrl+Z để hoàn tác thay đổi)</h5>
        <button type="button" class="btn-close" [disabled]="!questionValid()" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col mb-3">
            <label for="nameBasic" class="form-label">Nội dung câu hỏi</label>
            <input [(ngModel)]="question.content" type="text" id="nameBasic" class="form-control">
          </div>
        </div>
        <div class="row g-2">
          <div class="col-md mb-0">
            <label for="emailBasic" class="form-label">Đáp án A</label>
            <input [(ngModel)]="question.answerA" type="text" class="form-control">
          </div>
          <div class="col-md mb-0">
            <label for="dobBasic" class="form-label">Đáp án B</label>
            <input [(ngModel)]="question.answerB" type="text" class="form-control">
          </div>
        </div>
        <div class="row g-2 mt-2">
          <div class="col-md mb-0">
            <label for="emailBasic" class="form-label">Đáp án C</label>
            <input [(ngModel)]="question.answerC" type="text" class="form-control">
          </div>
          <div class="col-md mb-0">
            <label for="dobBasic" class="form-label">Đáp án D</label>
            <input [(ngModel)]="question.answerD" type="text" class="form-control">
          </div>
        </div>
        <div class="col-md mt-3">
          <small class="text-dark fw-bold d-block">Đáp án đúng</small>
          <div class="form-check form-check-inline mt-1">
            <input (change)="question.correctAnswer=1" [checked]="question.correctAnswer==1" class="form-check-input" type="radio" name="inlineRadioOptions" id="editRadio1" value="option1">
            <label class="form-check-label" for="inlineRadio1">A</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=2" [checked]="question.correctAnswer==2" class="form-check-input" type="radio" name="inlineRadioOptions" id="editRadio2" value="option2">
            <label class="form-check-label" for="inlineRadio2">B</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=3" [checked]="question.correctAnswer==3" class="form-check-input" type="radio" name="inlineRadioOptions" id="editRadio3" value="option3">
            <label class="form-check-label" for="inlineRadio3">C</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=4" [checked]="question.correctAnswer==4" class="form-check-input" type="radio" name="inlineRadioOptions" id="editRadio4" value="option4">
            <label class="form-check-label" for="inlineRadio4">D</label>
          </div>
        </div>

        <small *ngIf="!questionValid()" class="form-text text-danger">
          Không thể để trường giá trị rỗng
        </small>

      </div>

      <div class="modal-footer">
        <button [disabled]="!questionValid()" type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Add question modal -->
<div class="modal fade" id="addModal" tabindex="-1" style="display: none;" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Thêm câu hỏi</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col mb-3">
            <label for="nameBasic" class="form-label">Nội dung câu hỏi</label>
            <input [(ngModel)]="question.content" type="text" id="nameBasic" class="form-control">
          </div>
        </div>
        <div class="row g-2">
          <div class="col-md mb-0">
            <label for="emailBasic" class="form-label">Đáp án A</label>
            <input [(ngModel)]="question.answerA" type="text" class="form-control">
          </div>
          <div class="col-md mb-0">
            <label for="dobBasic" class="form-label">Đáp án B</label>
            <input [(ngModel)]="question.answerB" type="text" class="form-control">
          </div>
        </div>
        <div class="row g-2 mt-2">
          <div class="col-md mb-0">
            <label for="emailBasic" class="form-label">Đáp án C</label>
            <input [(ngModel)]="question.answerC" type="text" class="form-control">
          </div>
          <div class="col-md mb-0">
            <label for="dobBasic" class="form-label">Đáp án D</label>
            <input [(ngModel)]="question.answerD" type="text" class="form-control">
          </div>
        </div>
        <div class="col-md mt-3">
          <small class="text-dark fw-bold d-block">Đáp án đúng</small>
          <div class="form-check form-check-inline mt-1">
            <input (change)="question.correctAnswer=1" [checked]="question.correctAnswer==1" class="form-check-input" type="radio" name="inlineRadioOptions2" id="createRadio1" value="option1">
            <label class="form-check-label" for="inlineRadio1">A</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=2" [checked]="question.correctAnswer==2" class="form-check-input" type="radio" name="inlineRadioOptions2" id="createRadio2" value="option2">
            <label class="form-check-label" for="inlineRadio2">B</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=3" [checked]="question.correctAnswer==3" class="form-check-input" type="radio" name="inlineRadioOptions2" id="createRadio3" value="option3">
            <label class="form-check-label" for="inlineRadio3">C</label>
          </div>
          <div class="form-check form-check-inline">
            <input (change)="question.correctAnswer=4" [checked]="question.correctAnswer==4" class="form-check-input" type="radio" name="inlineRadioOptions2" id="createRadio4" value="option4">
            <label class="form-check-label" for="inlineRadio4">D</label>
          </div>
        </div>

        <small *ngIf="!questionValid()" class="form-text text-danger">
          Không thể để trường giá trị rỗng
        </small>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
          Close
        </button>

        <button [disabled]="!questionValid()" (click)="addNewQuestion()" type="button" class="btn btn-primary" data-bs-dismiss="modal">Thêm câu hỏi</button>
      </div>
    </div>
  </div>
</div>
